#!/usr/bin/make -f

export DH_VERBOSE = 1
export DEB_BUILD_MAINT_OPTIONS = hardening=+all

SUBSTVARS = -Vshlibs:Depends="libzmq5 (>= 4.2.1~), libc6"

%:
	dh $@ -P debian/target/${DEB_TARGET_ARCH} --with=systemd

override_dh_systemd_enable:
	dh_systemd_enable -plake --name=lake lake.path
	dh_systemd_enable -plake --name=lake lake.service
	dh_systemd_enable -plake --name=lake-relay lake-relay.service

override_dh_systemd_start:
	dh_systemd_start -plake --name=lake lake.path
	dh_systemd_start -plake --name=lake lake.service
	dh_systemd_start -plake --name=lake-relay lake-relay.service

override_dh_installinit:
	dh_installinit --noscript
	@mv debian/target/${DEB_TARGET_ARCH}/usr/bin/lake-linux-${DEB_TARGET_ARCH} debian/target/${DEB_TARGET_ARCH}/usr/bin/lake

override_dh_gencontrol:
	dh_gencontrol -- $(SUBSTVARS)

clean:
	rm -f debian/debhelper-build-stamp || :
	rm -f debian/files || :
	rm -rf debian/*.debhelper* || :
	rm -rf debian/*.substvars || :
