#!/bin/bash

set -Eeuo pipefail
trap exit INT TERM

scan() {
  if [ -f ${1} ] ; then
    echo ">> gofmt ${1}"
    gofmt -s -w ${1}
    echo ">> golint ${1}"
    /go/bin/golint ${1}
    echo ">> misspell ${1}"
    /go/bin/misspell ${1}
    echo ">> prealloc ${1}"
    /go/bin/prealloc ${1}
    echo ">> gocyclo -over 15 ${1}"
    /go/bin/gocyclo -over 15 ${1}
    echo ">> prealloc ${1}"
    /go/bin/prealloc ${1}
    echo ">> goconst ${1}"
    /go/bin/goconst ${1}
  fi
}

find . -name "*.go" -not -path "*vendor/*" \
| sort -u \
| while read f ; do
  scan ${f}
done
